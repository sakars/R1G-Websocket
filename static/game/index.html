<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <style>
    button{
      position: absolute;
      top:600px;
      left:0px;
    }
    canvas{
      position: absolute;
      left:0px;
      top:0px;
    }
    body{
      margin: 0;
    }
  </style>
<meta charset="utf-8">
<title>Fight arena</title>
</head>
<body>
  <canvas id="Canvas" width="900" height="600" style="background-color:grey"></canvas>
  <button onclick="connectSocket()">Connect</button>
  <script src="/socket.io/socket.io.js"></script>
  <script src="/js/SVGBuilder.js"></script>
  <script src="sockets.js"></script>
  <script type="text/javascript">
  var pressedK=[];
  var ctx=Canvas.getContext("2d");
  var me={x:10,y:10};
  function handleKeyDown(event){//event.key
    if(!pressedK.includes(event.key)){
      pressedK.push(event.key);
      socket.emit("update",JSON.stringify({id:socket.id, keys:pressedK}));
    }
  }
  function handleKeyUp(event){//event.key
    if(pressedK.includes(event.key)){
      pressedK.splice(pressedK.indexOf(event.key),1);
      socket.emit("update",JSON.stringify({id:socket.id, keys:pressedK}));
    }
  }
  function update(){
    var send=false;
    if(pressedK.includes("a")){
      me.x--;
      send=true;
    }
    if(pressedK.includes("d")){
      me.x++;
      send=true;
    }
    if(pressedK.includes("w")){
      me.y--;
      send=true;
    }
    if(pressedK.includes("s")){
      me.y++;
      send=true;
    }
    if(send){
      socket.emit("force",JSON.stringify(me));
    }
    ctx.clearRect(0,0,Canvas.width,Canvas.height);
    players.forEach(function(a){
      ctx.beginPath();
      ctx.arc(a.x,a.y,5,0,Math.PI*2);
      ctx.fill();
    });
    setTimeout(update,10);
  }
  window.addEventListener('keydown', handleKeyDown, true);
  window.addEventListener('keyup', handleKeyUp, true);
  window.addEventListener("mousemove",move,true);
  function move(e){
  }
</script>
</body>
</html>
